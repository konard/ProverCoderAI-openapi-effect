name: Release
on:
  workflow_run:
    workflows: ["Check"]
    branches: [main]
    types: [completed]

permissions:
  contents: write
  actions: write
  id-token: write
  pull-requests: write
  packages: write

jobs:
  release:
    if: github.event.workflow_run.conclusion == 'success'
    runs-on: ubuntu-latest
    steps:
      - uses: ProverCoderAI/action-release@v1.0.17
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          npm_token: ${{ secrets.NPM_TOKEN }}
          ref: ${{ github.event.workflow_run.head_sha }}
          branch: ${{ github.event.workflow_run.head_branch }}
          package_json_path: packages/app/package.json
          pnpm_filter: ./packages/app
          bump_type: patch
          publish_npm: true
          publish_github_packages: true
          skip_if_unchanged: true
          cancel_on_no_changes: true
